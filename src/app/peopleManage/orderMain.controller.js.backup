(function() {
    'use strict';

    angular
        .module('suzhou')
        .controller('OrderMainController', OrderMainController);

    /** @ngInject */
    function OrderMainController($scope, $http, $state, $modal, DataService, Tools) {
        $scope.orderHead = ['时间', '名称', '产品', '金额', '状态', '最后修改', '明细', '操作'];

        // -- 网络请求相关定义
        $scope.searchInfo = {
            order: {
                peoplename: '',
                ordername: '',
                orderstatus: '',
                startTime: '',
                endTime: ''
            },
            page: {
            	pageNo: 1,
            	pageSize: 15,
            }
        };
        $scope.search = function() {
            $http.post(Setting.host + 'order/index', $scope.searchInfo).success(function(data){
                if (data.orders && !(data.orders instanceof Array)) {
                    data.orders = [data.orders];
                }
                $scope.data = data;
            }).error(function(data) {

            });
        };

        // 将挂载在数据服务上的数据取回，若为空，则请求网络数据，并挂载.
        $scope.data = DataService.fetch($state.current.name);
        if (_.isEmpty($scope.data)) {
            $scope.search(function() {
                DataService.mount($state.current.name, $scope.data);
            });
        }

        // -- 页面相关数据以及控制
        $scope.add = function() {
            $scope.$parent.updatePageShow = true;
            $scope.$parent.viewPageShow = false;
        };
        $scope.edit = function(order) {
            $state.go('main.orderupdate', {orderid: order.id});
        };
        // // -- 旧的 页面相关数据以及控制
        // $scope.add = function() {
        //     var addorder = {
        //         id: '',
        //         name: '',
        //         price: '',
        //         ordertype: '0'
        //     };
        //     var modal = {
        //         title: '添加材料',
        //         order: addorder,
        //     };

        //     openModal(modal, function(data) {
        //         //刷新页面
        //         $scope.search();
        //     }, function(data) {

        //     });
        // };
        // $scope.edit = function(order) {
        //     $state.go('main.orderupdate', {orderid: order.id});
        // };
    }

})();
